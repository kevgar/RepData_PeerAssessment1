---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---

**Setup environment**
```{r, hide=TRUE, message=FALSE}
rm(list=ls())
library("data.table"); library("dplyr")
setwd('~/GitHub/05_ReproducableResearch/RepData_PeerAssessment1')
```
**Load data**
```{r}
f <- file.path(getwd(),"activity.zip")
unzip(f)
DT_activity<-data.table(read.csv(file.path(getwd(),"activity.csv")))
```

## What is mean total number of steps taken per day?
To answer this question, we first group the original data table by date
```{r}
DT_activity <- group_by(DT_activity,date) 
```
Then we calculate the total number of steps taken per day and store the result as a new data table
```{r}
DT_totalSteps <- summarise(DT_activity, sum(steps))
```
Then we assign column lables in the new data table
```{r}
setnames(DT_totalSteps, c("date","totalSteps"))
```
Then we ungroup the original data table so we can make use of it again later. 
```{r}
summarise(ungroup(DT_activity), sum(steps))
```
Then we use the new data table to generate a histogram of the total number of steps taken per day

```{r}
with(DT_totalSteps,
        hist(totalSteps, 
                main="Histogram of Steps Taken Per Day",
                xlab="Number of steps taken per day"
        )
)
```

Calculate and report the mean and median of the total number of steps taken per day

We do this by calculating the mean and median of `totalSteps` and storing the result as a new data table.
```{r}
DT_totalStepsSummary <- summarise(DT_totalSteps, 
        mean(totalSteps,na.rm=T),median(totalSteps,na.rm=T))
```
The resulting data table has one observation of two variables. We assign column labels and display the result.
```{r}
setnames(DT_totalStepsSummary, c("mean","median"))
data.table(DT_totalStepsSummary)
```




## What is the average daily activity pattern?
To answer the question, we first group the activity data by 5-minute time interval. 
```{r}
DT_activity <- group_by(DT_activity,interval)
```
Then we calculate the average number of steps taken by interval and store the result as a new data table.
```{r}
DT_activityPattern <- summarise(DT_activity, mean(steps))
```
Viewing the new data table we see that the values for `mean(steps)` are all NA. This is probably because each 5-minute interval has at least one incomplete case and therefore NA is returned for the arithmatic mean. We can strip out the NA values before computation proceeds by specifing `na.rm=TRUE` within the call to `mean()`.
```{r}
DT_activityPattern <- summarise(DT_activity, mean(steps,na.rm=TRUE))
```
Then we assign column lables in the new data table
```{r}
setnames(DT_activityPattern, c("interval","averageSteps"))
```
Viewing the new data table we that the values for `averageSteps` are all numeric.

Then we ungroup the original data table so we can make use of it again later. 
```{r}
summarise(ungroup(DT_activity), mean(steps, na.rm=TRUE))
```
Next we use the new data table to generate a time series plot of the average number of steps taken (y-axis) over each of the 5-minute intervals (x-axis). To make the plot easier to read, we change the `interval` column to a `1:288` to denoting the 5-minute intervals in a day.
```{r}
DT_activityPattern[,interval:=c(1:nrow(DT_activityPattern))]
```

```{r}
with(DT_activityPattern,
        plot(interval, averageSteps,
                main="Daily Activity Pattern",
                xlab="5-minute interval",
                ylab="Average number of steps taken",
                type="l"
                
        )
)
```

**Which 5-minute interval, on average across all the days in the dataset, contains the maximum number of steps?**  

 To answer the question, we calculate the maximum of `averageSteps` and store the result as a new data table. 
```{r}
DT_maxAverageSteps <- summarize(DT_activityPattern, which.max(averageSteps))
```
The resulting data table has one observation of one variable. Displaying the result we the maximum `averageSteps` occurs in the 104th 5-minute interval.
```{r}
data.table(DT_maxAverageSteps)
```




## Imputing missing values

Calculate and report the total number of missing values in the dataset (i.e. the total number of rows with NAs)

```{r}
sum(is.na(DT_activity$steps))
```

Next we are asked to devise a strategy for filling in all of the missing values in the dataset.

To fill NA values we use the mean number of steps taken for the corresponding 5-minute interval. 

To obtain these values we, first need to group the original data by interval 
```{r}
DT_activity <- group_by(DT_activity,interval)
```
Then we calculate average number of steps taken for each interval and store the result as a new data table. 
```{r}
DT_impute <- summarise(DT_activity, mean(steps,na.rm=TRUE))
```
Then we assign column labels to the new data table
```{r}
setnames(DT_impute, c("interval","imputedSteps"))
```
Then we replace `interval` in the original data table with a repeating index from 1-288 to denote the 5-minute intervals in a day
```{r}
DT_activity[,interval:=rep(1:nrow(DT_impute),length.out=nrow(DT_activity))]
```
Next we add a column to the original data table with a repeating vector of the imputed values
```{r}
DT_activity[,imputedSteps := rep(DT_impute$imputedSteps,length.out=nrow(DT_activity))]
```
Then we add a new column to the data table that is identical to `steps` but with NA values replaced with the computed values from `imputedSteps`
```{r}
DT_activity$stepsComplete<-ifelse(!is.na(DT_activity$steps),DT_activity$steps,DT_activity$imputedSteps)
```
Finally we assign a label for the new column
```{r}
setnames(DT_activity,c("steps","date","interval","imputedSteps","stepsComplete"))
```
Make a histogram of the total number of steps taken each day and Calculate and report the mean and median total number of steps taken per day.

To do this we first need to group the data by date
```{r}
DT_activity <- group_by(DT_activity,date)
```
Then we calculate the total number of steps taken by date
```{r}
DT_totalStepsComplete <- summarise(DT_activity, sum(stepsComplete))
```
Then we assign column lables for the new data table
```{r}
setnames(DT_totalStepsComplete, c("date","totalStepsComplete"))
```

Then we can create a histogram
```{r}
with(DT_totalStepsComplete,
        hist(totalStepsComplete, 
                main="Histogram of Steps Taken Per Day",
                xlab="Number of steps taken per day"
        )
)
```

Calculate and report the mean and median total number of steps taken per day

We do this by calculating the mean and median of `totalStepsComplete` and storing the result as a new data table.
```{r}
DT_totalStepsCompleteSummary <- summarise(DT_totalStepsComplete, 
        mean(totalStepsComplete),median(totalStepsComplete))
```
The resulting data table has one observation of two variables. We assign column labels and display the result.
```{r}
setnames(DT_totalStepsCompleteSummary, c("mean","median"))
data.table(DT_totalStepsCompleteSummary)
```
**Do these values differ from the estimates from the first part of the assignment?**
The new values are almost the same as the estimates from the first part of the assignment. The mean is `10766.19` which is identical to the previous mean. The median is `10766.19`, wheras before the median was `10765`.

## Are there differences in activity patterns between weekdays and weekends?
